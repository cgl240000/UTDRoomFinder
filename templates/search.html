{% extends "base.html" %}
{% block content %}
    <h2>Find an Open Room</h2>
    <form id="search-form" action="{{ url_for('search_results') }}" method="POST">
        <label for="building">Building:</label>
        <select id="building" name="building">
            <option value="Any Building">Any Building</option>
            {% for building in buildings %}
                <option value="{{ building }}">{{ building }}</option>
            {% endfor %}
        </select><br>

        <label for="room">Room Number:</label>
        <select id="room" name="room">
            <option value="Any Room Number">Any Room Number</option>
        </select><br>

        <label for="date">Date:</label>
        <input type="date" id="date" name="date" value="{{ today }}"><br>

        <label for="start_time">Start Time:</label>
        <input type="time" id="start_time" name="start_time"><br>

        <label for="end_time">End Time:</label>
        <input type="time" id="end_time" name="end_time"><br>

        <div class="form-buttons">
            <button type="button" id="reset-button">Reset</button>
            <button type="submit">Search</button>
        </div>
    </form>

    <script>
        // Pass building-to-rooms mapping to JavaScript
        const buildingToRooms = JSON.parse('{{ building_to_rooms | tojson | safe }}');

        // Update room dropdown based on selected building
        document.getElementById('building').addEventListener('change', function() {
            const building = this.value;
            const roomSelect = document.getElementById('room');
            roomSelect.innerHTML = '<option value="Any Room Number">Any Room Number</option>';
            if (building !== 'Any Building' && buildingToRooms[building]) {
                buildingToRooms[building].forEach(room => {
                    const option = document.createElement('option');
                    option.value = room;
                    option.textContent = room;
                    roomSelect.appendChild(option);
                });
            }
        });

        // Reset form and room dropdown
        document.getElementById('reset-button').addEventListener('click', () => {
            const form = document.getElementById('search-form');
            form.reset();
            const roomSelect = document.getElementById('room');
            roomSelect.innerHTML = '<option value="Any Room Number">Any Room Number</option>';
        });
    </script>
{% endblock %}